import{s as b,f as k,l as D,g as v,h as x,m as B,d as m,j as g,k as O,i as C,x as S,z as T,E as w}from"./scheduler.101db06a.js";import{S as z,i as E}from"./index.5bc76508.js";import{d as N,t as q}from"./downloadBlob.6273a68b.js";import{u as I}from"./Brush.html.47f59408.js";function J(i){let t,o,e,p;return{c(){t=k("button"),o=D("Download      "),this.h()},l(l){t=v(l,"BUTTON",{title:!0,class:!0,style:!0});var c=x(t);o=B(c,"Download      "),c.forEach(m),this.h()},h(){t.disabled=i[0],g(t,"title","download zip file"),g(t,"class","icon svelte-1gef78k"),O(t,"background-image","url(/icons/download.svg)")},m(l,c){C(l,t,c),S(t,o),e||(p=T(t,"click",i[1]),e=!0)},p(l,[c]){c&1&&(t.disabled=l[0])},i:w,o:w,d(l){l&&m(t),e=!1,p()}}}function L(i=""){return(i.match(/from\s'(.+)'?/gm)||[]).map(e=>e.replace(/(from |'|"|;)/g,"")).filter(e=>!e.startsWith("."))}function M(i,t,o){let{data:e={}}=t,{slug:p}=t,{ssr:l=!1}=t,c=!1;const u=[e.main,...e.components,...e.componentComponents].reduce((a,n)=>a.concat(L(n.contents)),[]).reduce((a,n)=>(a.includes(n)||a.push(n),a),[]);async function _(){o(0,c=!0),console.log("downloading");const a=new Date().getTime(),n=await(await window.fetch(`/svelte-app.json?${a}`)).json(),f=await(await window.fetch(`/deps.json?${a}`)).json();if(u.length>0){const s=n.findIndex(({path:r})=>r==="package.json"),d=JSON.parse(n[s].data),h={},y={};u.forEach(r=>{r!=="svelte"&&(h[r]=f[r],f[r]||window.alert(`Missing dependency, add "${r}" to this repo's package.json`))}),Object.assign(d.dependencies,h),Object.assign(d.devDependencies,y),n[s].data=JSON.stringify(d,null,"  ")}n.push(...e.components.map(s=>({path:`src/routes/${s.title.replace("./","")}`,data:s.contents}))),n.push(...e.modules.map(s=>({path:`src/routes/${s.title.replace("./","")}`,data:s.contents}))),n.push(...e.componentModules.map(s=>({path:`src/routes/${s.title.replace("../","")}`,data:s.contents}))),n.push(...e.componentComponents.map(s=>({path:`src/routes/${s.title}`,data:s.contents}))),n.push(...e.csvs.map(s=>({path:`src/routes/${s.title.replace("../","")}`,data:s.contents}))),n.push(...e.jsons.map(s=>({path:`src/routes/${s.title.replace("../","")}`,data:s.contents}))),n.push({path:"src/routes/+page.svelte",data:e.main.contents}),console.log("here",n);const j=I(n.filter(Boolean),"path",!1);N(q(j),`layercake-${l?"ssr-":""}${p}.zip`),o(0,c=!1)}return i.$$set=a=>{"data"in a&&o(2,e=a.data),"slug"in a&&o(3,p=a.slug),"ssr"in a&&o(4,l=a.ssr)},[c,_,e,p,l]}class W extends z{constructor(t){super(),E(this,t,M,J,b,{data:2,slug:3,ssr:4})}}function G(i){const t=i.split("/"),o=t[t.length-1].split(".");return o.pop(),o.join(".").toLowerCase()}export{W as D,G as c};
